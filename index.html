<!Doctype html>
<html>
<head>
<title>TSA Claims by Month</title>

<link rel="stylesheet" type="text/css" href="styles.css">
<meta name="viewport" content="width=device-width, initial-scale=1" /> 

<script src="xlsx.full.min.js"></script>
<script src="app.js"></script>

</head>
<body>
<h1>TSA Claims by month from 2010-2013</h1>

<h2>Please be patient for the data to load, the Javascript on this page is quiet extensive</h2>

<div class="loader" id="topLoader" ></div>
<!--<progress id="ProgressBar" value="0" max="100"></progress>-->

<p id="ProgressUpdate" hidden="true" >INCIDENTS BY MONTH:</p>
<script>
 var dataArray;
 
 var monthData = {month:"",incidents:0,};
 function MonthData(theMonth)
 {
   this.month=theMonth;
   this.incidents=0;
 }


/*
  Parameters: "data"- Should be an Array of JSON objects representing data from the TSAClaimsDataFile
  Outputs: Writes to the Console the JSON Array

*/
 function callBackData(data)
  {
    dataArray=data;
    
    // Pop off last value it is not what we want 
    dataArray.pop();

    callBackProgress(100);

    var monthArray= new Array();

    for(var i=0; i<12; i++)
    {
      monthArray.push(new MonthData(monthNumToString(i+1)));
      
    }    

    dataArray.forEach(element => {
          
       
         var incidentMonth =  monthNumToString(getMonthFromDate(element["Incident Date"]));

         monthArray.forEach(element => {

                if(element.month==incidentMonth)
                {
                  element.incidents++;
                }
         });
           
    });
   // console.log(monthArray);
    var paragraph = document.getElementById("ProgressUpdate");
    var pText="";
             monthArray.forEach(element => {

              pText+= "There were "+element.incidents+" incidents in "+element.month+"<br></br>";
              console.log(pText);
         });
         paragraph.innerHTML=pText;
         paragraph.hidden=false;
  }


  /*
    Parameters: "progress"- Should be an interger representing progress in getDataFromExcel
    Outcomes: parameter will be used to update the progress bar, and 
    inform the user on the status of getDataFromExcel
  
  */
 function callBackProgress(progress)
 {
   console.log("Making Progress");
   console.log(progress);
 //  var ProgressText= document.getElementById("ProgressUpdate");
  // var ProgressBar = document.getElementById("ProgressBar");
     var spinner = document.getElementById("topLoader");
   switch(progress)
   {
     case 25:
      //    ProgressText.innerHTML="In Onload";
      //    ProgressBar.value="25";
          break;
     case 50:
      //    ProgressText.innerHTML="Made it through for loop";
     //     ProgressBar.value="50";
          break;
     case 75:
      //    ProgressText.innerHTML="Converted workbook";
      //    ProgressBar.value="75";
          break;
     case 100:
       //   ProgressText.innerHTML="Done!!";
          //ProgressBar.value="100";
          spinner.hidden=true;
          break;
   }
   
 }

 /*
  Parameter: dateToParse- Takes in a  string which is a date formatted Month/Day/Year
  Outputs: Returns the Month on its own from the Given String
 */
 function getMonthFromDate(dateToParse)
 {
   //console.log(dateToParse);
   if(dateToParse==undefined||dateToParse==null) 
   { console.log("The Special case"); 
      return 0;

   }

    var datePieces=dateToParse.split("/");

    return datePieces[0];
 }

/*
  Parameter: The number of a month as an Interger or a string
  Outcomes: Returns the name of the numerically represented month as a string Ex: 1 returns "January"
*/
 function monthNumToString(monthNumber)
 {
   if(0) return 97;
   
   if(typeof(monthNumber)==typeof(""))
   {
    switch(monthNumber)
      {
        case '1':
          return "January";
          break;
        case '2':
          return "February";
          break
        case '3':
          return "March";
          break;
        case '4':
          return "April";
          break;
        case '5':
          return "May";
          break;
        case '6':
          return "June";
          break;
        case '7':
          return "July";
          break;
        case '8':
          return "August";
          break;
        case '9':
          return "September";
          break;
        case '10':
          return "October";
          break;
        case '11':
          return "November";
          break;
        case '12':
          return "December";
          break;

      } 

   }
   else if(typeof(monthNumber)==typeof(0))
   {
   
    switch(monthNumber)
      {
        case 1:
          return "January";
          break;
        case 2:
          return "February";
          break
        case 3:
          return "March";
          break;
        case 4:
          return "April";
          break;
        case 5:
          return "May";
          break;
        case 6:
          return "June";
          break;
        case 7:
          return "July";
          break;
        case 8:
          return "August";
          break;
        case 9:
          return "September";
          break;
        case 10:
          return "October";
          break;
        case 11:
          return "November";
          break;
        case 12:
          return "December";
          break;

      }
   }
 }


 getDataFromExcel(callBackData,callBackProgress);


 
</script>
</body>
</html>

